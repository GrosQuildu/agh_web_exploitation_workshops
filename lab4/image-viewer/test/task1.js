var supertest = require("supertest");
var chai = require('chai');
chai.use(require('chai-json'));

var server = supertest.agent("http://localhost:3000");
var expect = chai.expect;

describe('task1 solve', function() {
    it('returns the flag', function(done) {
       server
       .post('/task1')
       .type('form')
       .set("X-Task", 1)
       .send({"url": "http://localhost:8888"})
       .expect('Content-Type', /html/)
       .expect(200)
       .end((err, res) => {
           expect(res.text).to.include("flag{");
           done();
       });
    });
});

describe('error handling', function() {
    it('reuturns 500 on unreachable host', function(done) {
       server
       .post('/task1')
       .type('form')
       .set("X-Task", 1)
       .send({"url": "http://localhost:12345"})
       .expect('Content-Type', /html/)
       .expect(500)
       .end((err, res) => {
           done();
       });
    });
});