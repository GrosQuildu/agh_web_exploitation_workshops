## Do pobrania i zainstalowania
#### narzędzia
[nmap](https://nmap.org/)
[masscan](https://github.com/robertdavidgraham/masscan)
[massdns](https://github.com/blechschmidt/massdns)

#### wordlisty do pobrania
https://raw.githubusercontent.com/danielmiessler/SecLists/master/Usernames/cirt-default-usernames.txt
https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/darkweb2017-top1000.txt

## Przygotowanie zadań
```
docker-compose build
```
## Instrukcje do zadań
0. serwisy
```
docker-compose up open
docker-compose up mongo
docker-compose up instruction
```
Zadanie, włącznie z jego treścią, znajduje się na aghws.jctf.pl, gdzieś na portach 15000-20000.
#### Porty 22, 80, 443, 5015, 11994 **nie** są częścią zadnia. Atakowanie ich grozi banem.
1. SSRFy - image viewer
```
docker-compose up image-viewer
```
1.1 Flaga jest dostępna na serwerze działającym na porcie 8888 w tym samym środowisku, co aplikacja image viewer, ale port 8888 nie jest wystawiony na świat.
1.2 Flaga również jest na porcie 8888, ale tym razem są pewne zabezpieczenia, które mają uchronić przed możliwością wysyłania żądań na localhost. Fragment kodu źródłowego serwera:
```javascript
  let url_to_connect = req.body.url;
  let hostname = '';
  // only http and https protocols are allowed
  if (url_to_connect.startsWith("https://")){
    hostname = url_to_connect.substring(8);
  }
  else if (url_to_connect.startsWith("http://")){
    hostname = url_to_connect.substring(7);
  }
  else{
    return res.status(403).send("only http and https protocols are allowed");
  }

  // do not care about the path
  if (hostname.indexOf('/') !== -1){
    hostname = hostname.split('/')[0];
  }
  // do not allow tricks with @
  if (hostname.indexOf("@") !== -1){
    return res.status(403).send("@ is not allowed")
  }
  // do not allow IPv6
  if (hostname.indexOf("::") !== -1){
    return res.status(403).send("ipv6 is not allowed");
  }
  // last value after the : is the port 
  if (hostname.indexOf(":") !== -1){
    hostname = hostname.split(":")[0];
    if (hostname.indexOf(":") !== -1){
      return res.status(403).send("ipv6 is not allowed");
    }
  }
  // only allow domains from trusted websites
  if (hostname.match(/[A-Za-z]/) !== null){
    if (hostname !== "google.com" && hostname !== "imgur.com"){
      return res.status(403).send("domain names are not allowed");
    }
  }
  // disallow different local network addresses
  if (hostname.startsWith("127.") || hostname.startsWith("172.") || hostname.startsWith("192.168") || hostname.startsWith("10")){
    return res.status(403).send("requests to localhost are not allowed");
  }
  // disallow decimal ips
  if( !isNaN(hostname)){
    return res.status(403).send("requests to decimal IPs are not allowed");
  }
  // surely we are safe, aren't we?
  // finally make the request
```
3. Privilege escalation
To zadanie robimy tylko na naszym serwerze. Aby zdobyć flagę należy być zalogowanym jako admin.
(https://aghws.jctf.pl/lab4/task3)[https://aghws.jctf.pl/lab4/task3]