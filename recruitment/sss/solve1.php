<?php

class Signer {

    public $p;
    public $q;
    public $g;
    public $x;
    public $y;

    public function __construct() {
        $this->p = gmp_init("89146282846243225107007068266519982659711154860396010580323493139483658408898415573500322302506435048668242632620906084386851681735878612167172498138186357321203506746407095216884490332206919417703081450848051706674272531931443171270319191755406859398101400521081147209143883046760159479156772640783246194979");
        $this->q = gmp_init("981395831986248833903336248299632769004969418227");
        $this->g = gmp_init("60161586900699784633947546870377562611235045297882795960763945864687212187261828096892253404655484596726985884824540984759911757139659840260529479175039170428142722743430594271138140411843100489138961810563204049814953877109846646088811751229484587664604629256578523915239806747692225943170473587716030984630");
    }

    private function red($m) {
        $x = 13377331;
        for ($i = 0; $i < strlen($m); $i++) {
            $x = 7*($x << 1 | $x >> 31);
            $x ^= ord($m[$i]);
            $x &= 0xffffffff;
        }
        return $x;
    }

    public function computeX($yo, $lo, $m) {
	$p = $this->p;
    $q = $this->q;
    $g = $this->g;

	$lo_m = gmp_mod(gmp_mul($lo,$this->red($m)), $q);
	$lo_m_hm = gmp_mod(gmp_sub($lo_m, gmp_init(hash("sha1", $m), 16)), $q);
	$x = gmp_mod(gmp_mul($lo_m_hm, gmp_invert($yo, $q)), $q);
	echo $x;
    }

}

$s = new Signer;
list($yo, $lo) = explode('.', '323815216006955940259487212882740600066873188552.684151713561859056189862940426075198195210420639');
$m = 'YTozOntzOjQ6InRpbWUiO3M6MjI6IjEwLzA1LzIwMTkgMDQ6MDg6NDEgcG0iO3M6NToiYWRtaW4iO2I6MDtzOjI6ImlwIjtzOjM6Ijo6MSI7fQ==';
$m = base64_decode($m);
$s->computeX($yo,$lo,$m);

