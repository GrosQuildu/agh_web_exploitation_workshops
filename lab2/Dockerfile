FROM node:13

RUN useradd -ms /bin/bash express
COPY . /home/express
RUN chown -R express:express /home/express/vulnerable_express_app
RUN apt-get update && apt-get -y install openssh-server supervisor
RUN mkdir -p /var/run/sshd
RUN echo "StrictModes no" >> /etc/ssh/sshd_config
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
user express
RUN mkdir /home/express/.ssh
RUN chmod 0700 /home/express/.ssh
WORKDIR /home/express/vulnerable_express_app
RUN npm install
EXPOSE 3000 22
user root
RUN chown express:express /home/express/flag
RUN chmod 0111 /home/express/flag
RUN rm /home/express/supervisord.conf
CMD ["/usr/bin/supervisord"]
