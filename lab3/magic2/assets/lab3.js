var apiPath = "/lab3/magic2/chat/"

function addZero(i) {
    if (i < 10) {
        i = "0" + i;
    }
    return i;
}

function insertText(input, nick="", send=false) {
    if ( input.length > 0 ) {
        var conversationPanel = document.getElementById("channelText"); 
        var hourInput = new Date();
        var ircOutputTime = addZero(hourInput.getHours()) + ":" + addZero(hourInput.getMinutes());
        conversationPanel.textContent +=  "\n" + "[" + ircOutputTime + "] " + nick + input;
        conversationPanel.scrollTop = conversationPanel.scrollHeight; 
        
        var inputUserText = document.getElementById('inputUser');
        if (send) {
            var logChat = new XMLHttpRequest();
            logChat.open('GET', apiPath + 'write?msg=' + inputUserText.value, true);
            logChat.send(null);
        }
        inputUserText.value = "";
    };
};

function startChat(){
    var conversationPanel = document.getElementById("channelText");
    var iframeNicks = document.getElementById('nicksFrame');
    var channelText = document.getElementById('channelText');

    setTimeout(function(){insertText("* Looking up irc.aghws.jhtc.net");}, 1000);
    conversationPanel.scrollTop = conversationPanel.scrollHeight;

    setTimeout(function(){insertText("* Connecting to irc.aghws.jhtc.net (13.73.73.13) port 777...");}, 2000);

    setTimeout(function(){
        var jctfText = ''
        var xhrIrcd = new XMLHttpRequest();
        xhrIrcd.open('GET', '/lab3/magic2/logo', true);
        xhrIrcd.onload = function(){
          jctfText = xhrIrcd.responseText;
          insertText(jctfText);

          setTimeout(function(){conversationPanel.textContent +=  "\n" + "* joining #AGH-magic2" + "\n";
          conversationPanel.scrollTop = conversationPanel.scrollHeight;}, 1000);

          setTimeout(function(){channelText.setAttribute('style','overflow-y: scroll;')},1400);
          setTimeout(function(){iframeNicks.setAttribute('style','display: block');},4000);

          setTimeout(function(){insertText(" Welcome my friend!","<@sroG>");
          conversationPanel.scrollTop = conversationPanel.scrollHeight;}, 5000);
        }
        xhrIrcd.send(null);
    }, 4000);
};

