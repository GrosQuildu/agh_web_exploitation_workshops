FROM python:latest

RUN useradd blog

WORKDIR /home/blog

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY app app
COPY migrations migrations
COPY blog.py config.py blog.db wsgi.py ./

ENV FLASK_APP blog.py

RUN chown -R blog:blog ./
USER blog

EXPOSE 5000

CMD gunicorn --workers 1 --bind 0.0.0.0:5000 wsgi:app --timeout 5 --keep-alive 5 --max-requests 1000